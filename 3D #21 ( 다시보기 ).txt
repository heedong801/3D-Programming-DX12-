5/17	pipeline02 8:26~ 수업
리소스 장벽
리소스는 한 순간의 하나의 상태를 가지게 만들어짐(생성할 때 초기상태를 가짐)
리소스의 상태를 바뀌는 것 : 상태 전이

바꿔야 하는 이유?
그래픽스 커맨드들을 사용할 때 커맨드들이 특정상태에서만 동작되게 되어있기 때문
GPU가 Resource(렌더타겟)에 쓸 때 렌더타겟 스테이트로, 다 쓰면 프레젠트를 위해 프레젠트 스테이트로 변환
Resource(뎁스버퍼)의 경우 프레젠트에서 쓰이지 않기 때문에 초기값으로 준 정보로 사용하면 됨

Lap5 -> GF.cpp 430

GPU의 입장에서
디폴트 힙 : GPU가 쓸거야( COPY_DEST )
업로드 힙 : GPU가 읽을거야 ( GENERIC_READ )

리소스의 상태 ( 파랑 : 읽기 빨강 : 쓰기 분홍 : 둘다 )

COMMON상태의 리소스는 상태전이가 자동
버퍼 : 예외(뎁스버퍼)

리소스 장벽
RESOURCE_BARRIER의 TYPE이 뭐냐에 따라 유니언 멤버에 해당 1학기땐 TRANS...만씀

RESOURCE_TRANSITION-BARRIER
버퍼는 SubResource가 없다.

RESOURCE_BARRIER_FLAGS
리소스 상태에 대해서 2가지로 또 나누는 것
BEGIN_ONLY : 이 리소스가 BEGIN상태가 안되어있으면 접근이 불가 상태전이 준비 되었으면 상태전이
but 우리는 none 쓸꺼다

무조건 상태전이가 일어나는 것은 아님
A라는 상태에서 B라는 상태가 되어서 B상태였을 때 가능한 함수를 부르려고 하지만 A라는 상태가 되어 있지 않을경우 오류발생 상태불일치

리소스의 생성
-정점버퍼의 생성
버퍼는 다중샘플링x, 버퍼니까 디멘션버퍼, 1차원배열, 포멧은 몰라

복사를 할 업로드힙 생성 - map함수로 시작주소 반환 - memcpy(복사할곳,복사된곳,복사크기) - 디폴트를 이제 gpu 카피 후 릴리즈

디바이스 인터페이스 클래스를 통한 함수로 즉시실행, but 커맨드리스트 함수는 gpu가 꺼낼때 실행

문제가 발생? 
명령어리스트의 함수가 큐에 들어감(큐에 넣었다고 실행이 되는 게 아님), 그러나 그 다음에 바로 Release 호출, 이 함수는 또 즉시호출이라
없어짐. 그래서 CopyResource때 왜 없는 메모리 불러오냐 오류발생

그래서, 커맨드큐가 빌 때까지 release함수 호출 ㄴㄴ
커맨드큐가 다 비어있는지 확인 위해 펜스오브젝트 사용(WaitforGPU 함수 리턴되면 그 때 릴리즈)
이것이 굳이 이 함수가 릴리즈할 업로드버퍼 포인터를 리턴한 이유이다.

다른 방법으로 업로드힙만 쓰면 되는데 디폴트힙쓸때와 성능차이가 난다.
왜냐면 업로드힙의 경우 동기화가 되어야 하기 때문이다.

입력-레이아웃
IA에 정점버퍼 연결위해 정점하나의 구조와 크기 알려줘야함

INPUT_LAYOUT_DESC
ELEMENT_DESC
시멘틱과, 시멘틱인덱스(ex 포지션0, 포지션1)
InputSlot 최대16개
Offset 포멧에 따라 계산, 자동계산가능
CLASSIFICATION 정수(모델좌표계)냐, 인스터스(객체의 정보)냐
DataSteoRate 0(정점일때), 인스턴승리땐 값에 따라

=======================================================================================================
리소스는 뷰를 통해서 파이프라인에 연결되며, 상태정보를 가지고 있다.
CreateCommittedResource 함수에서 초기 상태를 지정해 줄 수 있다.

디폴트 힙 리소스들은 리소스 상태로 COPY DEST로 넣어놔야 됨
업로드 힙 GENERIC READ로 초기, 업로드 힙에 쓴 다음 COPY DEST
리드백 힙 은 COPY DEST
텍스처 같은 경우 PIXEL_SHADER_RESOURCE

COMMON은 0으로 or 연산으로 상태를 여러개 가질수 있음

리소스에 대한 상태 전이를 하는 주체는 디바이스 드라이버, 그래픽 카드에 있는 디바이스 드라이버한테 상태 전이를 해달라고 DirectX에서 의뢰를 하는 것

디바이스 인터페이스를 통한 함수는 즉시 실행 but 커맨드리스트는 따로

정점버퍼의 생성 궁금한 점
업로드힙을 명령어리스트가 없을 때 릴리즈를 하기위해서 리턴값을 저장한다고 하였는데, 리턴 하는 값이 디폴트 힙임

인스터는 오브젝트의 정보 월드좌표계
정점의 정보는 모델좌표계